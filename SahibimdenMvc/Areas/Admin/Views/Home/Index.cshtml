@using SahibimdenMvc.Models.AdminModels
@model AdminViewModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="col-md-10" id="cerceve">
    <h1 style="text-align:center">Admin Paneline Hoşgeldiniz</h1>
    <p id="icerik"></p>
</div>

<div class="modal fade" id="markaEkle" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Marka Ekle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    @Html.Label("Marka")
                    @Html.TextBoxFor(a => a.Araba.Ad, new { @class = "form-control", @id = "markaEkleAd" })
                    <label id="lblMarkaBos" style="display:none;color:red">Marka Alanı Boş Geçilemez</label>
                </div>
                <input type="submit" name="btnMarkaEkle" value="Ekle" class="btn btn-success" onclick="return markaEkle()" />
            </div>
            @*<div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>*@
        </div>
    </div>
</div>

<div class="modal fade" id="markaDuzenle" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Markayı Düzenle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    @Html.Label("Marka")
                    @Html.TextBoxFor(a => a.Araba.Ad, new { @class = "form-control", @id = "markaDuzenleAd" })
                    <label id="lblMarkaDuzenleBos" style="display:none;color:red">Marka Alanı Boş Geçilemez</label>
                </div>
                <input type="submit" name="btnMarkaDuzenle" value="Düzenle" class="btn btn-success" onclick="return markaDuzenle()" />
            </div>
            @*<div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>*@
        </div>
    </div>
</div>

<div class="modal fade" id="seriEkle" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Seri Ekle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    @Html.Label("Marka Seçin")
                    <br />
                    <select class="form-control" id="markaseriekle" name="markaseriekle">
                    </select>
                </div>
                <div class="form-group">
                    @Html.Label("Seri")
                    @Html.TextBoxFor(a => a.Araba.Ad, new { @class = "form-control", @id = "seriEkleAd" })
                    <label id="lblSeriEkleBos" style="display:none;color:red">Seri Alanı Boş Geçilemez</label>
                </div>
                <input type="submit" name="btnSeriEkle" value="Seri Ekle" class="btn btn-success" onclick="seriEkle()" />
            </div>
            @*<div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>*@
        </div>
    </div>
</div>

<div class="modal fade" id="seriDuzenle" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Seri Ekle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    @Html.Label("Marka Seçin")
                    <br />
                    <select class="form-control" id="markaseriduzenle" name="markaseriduzenle">
                    </select>
                </div>
                <div class="form-group">
                    @Html.Label("Seri")
                    @Html.TextBoxFor(a => a.Araba.Ad, new { @class = "form-control", @id = "seriDuzenleAd" })
                    <label id="lblSeriDuzenleBos" style="display:none;color:red">Seri Alanı Boş Geçilemez</label>
                </div>
                <input type="submit" name="btnSeriDuzenle" value="Seriyi Güncelle" class="btn btn-success" onclick="seriDuzenle()" />
            </div>
            @*<div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>*@
        </div>
    </div>
</div>

<div class="modal fade" id="modelEkle" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Model Ekle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    @Html.Label("Marka Seçin")
                    <br />
                    <select class="form-control" id="markamodelekle" name="markamodelekle" onchange="seriFiltrele()">
                    </select>
                </div>
                <div class="form-group">
                    @Html.Label("Seri Seçin")
                    <br />
                    <select class="form-control" id="serimodelekle" name="serimodelekle">
                    </select>
                    <label id="lblModelEkleSeriBos" style="display:none;color:red">Seri Seçimi Zorunludur</label>
                </div>
                <div class="form-group">
                    @Html.Label("Seri")
                    @Html.TextBoxFor(a => a.Araba.Ad, new { @class = "form-control", @id = "modelEkleAd" })
                    <label id="lblModelEkleBos" style="display:none;color:red">Model Alanı Boş Geçilemez</label>
                </div>
                <input type="submit" name="btnModelEkle" value="Model Ekle" class="btn btn-success" onclick="modelEkle()" />
            </div>
            @*<div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>*@
        </div>
    </div>
</div>

<div class="modal fade" id="modelDuzenle" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Model Ekle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    @Html.Label("Marka Seçin")
                    <br />
                    <select class="form-control" id="markamodelduzenle" name="markamodelduzenle" onchange="seriFiltreleDuzenle()">
                    </select>
                </div>
                <div class="form-group">
                    @Html.Label("Seri Seçin")
                    <br />
                    <select class="form-control" id="serimodelduzenle" name="serimodelduzenle">
                    </select>
                    <label id="lblModelDuzenleSeriBos" style="display:none;color:red">Seri Seçimi Zorunludur</label>
                </div>
                <div class="form-group">
                    @Html.Label("Seri")
                    @Html.TextBoxFor(a => a.Araba.Ad, new { @class = "form-control", @id = "modelDuzenleAd" })
                    <label id="lblModelDuzenleBos" style="display:none;color:red">Model Alanı Boş Geçilemez</label>
                </div>
                <input type="submit" name="btnModelDuzenle" value="Modeli Güncelle" class="btn btn-success" onclick="modelDuzenle()" />
            </div>
            @*<div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>*@
        </div>
    </div>
</div>


@section scripts{
    <script src="~/Scripts/MyScripts/myscripts.js"></script>
    <script>
        function modelListele() {
            var temp;
            $.ajax({
                url: "/Admin/MSM/MarkaSeriModel",
                method: "Get",
                success: function (data) {
                    $("#icerik").find("table").remove();
                    var txt = "";
                    txt += "<table id='marka' class='table table-striped'>";
                    txt += "<tr><th> Model Adı </th>";
                    txt += "<th> İşlemler </th></tr>";
                    for (var i = 0; i < data.length; i++) {
                        var id = data[i].ArabaId;
                        var markaAd = data[i].Ad;
                        var ustKategori = data[i].UstKategori;
                        if (ustKategori == 0) {
                            temp = id;
                            txt += "<tr><th colspan='2' style='font-size:20px'>" + markaAd + "</th></tr>";
                        } else if (temp == ustKategori) {
                            txt += "<tr><th colspan='2' style='font-size:20px'>-----" + markaAd + "</th></tr>";
                        } else {
                            txt += "<tr><td>" + markaAd + "</td>";
                            txt += "<td><a href='#modelDuzenle' data-toggle='modal' class='btn btn-sm btn-primary' onclick=modelGetirDuzenle(" + id + ",'" + markaAd + "'," + ustKategori + ")>Duzenle</a> "
                            txt += "<a href='#' class='btn btn-sm btn-danger' onclick=modelSil(" + id + ")>Sil</a> </td></tr>"
                        }                    
                    }
                    txt += "</table>"
                    $("#icerik").append(txt);

                }, error: function () {
                    console.log("basarisiz");
                }
            });
        }

        function markaGetirModel() {
            $.ajax({
                url: "/Admin/MSM/Markalar",
                method: "Get",
                success: function (data) {
                    $("#markamodelekle").find("option").remove();
                    for (var i = 0; i < data.length; i++) {
                        var id = data[i].ArabaId;
                        var markaAd = data[i].Ad;
                        $("#markamodelekle").append("<option value='" + id + "'>" + markaAd + "</option>");
                    }
                }, error: function () {
                    console.log("basarisiz");
                }
            });
        }

        function seriFiltrele() {
            $.ajax({
                url: "/Admin/MSM/SeriFiltrele",
                method: "Post",
                data: {
                    id: $("#markamodelekle").val()
                },
                success: function (data) {
                    $("#serimodelekle").find("option").remove();
                    for (var i = 0; i < data.length; i++) {                    
                        $("#serimodelekle").append("<option value='" + data[i].ArabaId + "'>" + data[i].Ad + "</option>");
                    }
                },
                error: function () {
                    console.log("basarisiz");
                }
            });
        }


        function seriFiltreleDuzenle() {
            $.ajax({
                url: "/Admin/MSM/SeriFiltrele",
                method: "Post",
                data: {
                    id: $("#markamodelduzenle").val()
                },
                success: function (data) {
                    $("#serimodelduzenle").find("option").remove();
                    for (var i = 0; i < data.length; i++) {
                        $("#serimodelduzenle").append("<option value='" + data[i].ArabaId + "'>" + data[i].Ad + "</option>");
                    }
                },
                error: function () {
                    console.log("basarisiz");
                }
            });
        }

        function modelEkle() {
            var hatayok = true;        
            if ($("#modelEkleAd").val().trim() == "") {
                $("#lblModelEkleBos").show();
                $("#lblModelEkleSeriBos").hide();
                hatayok = false;
            } else if ($("#serimodelekle").val() == null) {
                $("#lblModelEkleSeriBos").show();
                $("#lblModelEkleBos").hide();
                hatayok = false;
            } else {
                $.ajax(
                    {
                        url: "/Admin/MSM/SeriEkle",
                        method: "Post",
                        data: {
                            Ad: $("#modelEkleAd").val(),
                            UstKategori: $("#serimodelekle").val()
                        }, success: function (data) {
                            if (data == "True") {
                                $("#modelEkleAd").val("");
                                $("#lblModelEkleBos").hide();
                                $("#lblModelEkleSeriBos").hide();
                                alert("Model Eklendi !!!");
                            } else {
                                alert("Model Eklemede Hata !!!");
                            }
                        }, error: function (data) {
                            alert("Bir Hata Oluştu !!!");
                        }
                    });
            }
            return hatayok;
        }

        function modelSil(id) {
            if (confirm("Modeli Silmeyi Onaylıyor Musunuz")) {
                $.ajax(
                    {
                        url: "/Admin/MSM/SeriSil",
                        method: "Post",
                        data: {
                            id: id
                        }, success: function (data) {
                            if (data == "True") {
                                alert("Model Silindi !!!");
                                modelListele();
                            } else {
                                alert("Model Silinemedi !!!");
                            }
                        }, error: function (data) {
                            alert("Bir Hata Oluştu!!!");
                        }
                    });
            } else {
                alert("İşlem İptal Edildi !!!");
            }
        }

        var modelId;
        var selectedModel;
        var select;
        function modelGetirDuzenle(id, modelAd, ustKategori) {
            selectedModel = modelAd;
            modelId = id;
            $.ajax({
                url: "/Admin/MSM/Seriler",
                method: "Get",
                success: function (data) {
                    $("#serimodelduzenle").find("option").remove();
                    for (var i = 0; i < data.length; i++) {
                        var id = data[i].ArabaId;
                        var markaAd = data[i].Ad;
                        $("#serimodelduzenle").append("<option value='" + id + "' name='" + data[i].UstKategori + "' id='" + id + "'>" + markaAd + "</option>");
                    }
                    $("#serimodelduzenle").val(ustKategori);
                    $("#modelDuzenleAd").val(selectedModel);
                    select = $("#serimodelduzenle").find("option:selected").attr("name");
                    markaGetirModelDuzenle();                 
                 
                }, error: function () {
                    console.log("basarisiz");
                }
            });
         
        }

        function markaGetirModelDuzenle() {
            $.ajax({
                url: "/Admin/MSM/Markalar",
                method: "Get",
                success: function (data) {
                    $("#markamodelduzenle").find("option").remove();
                    for (var i = 0; i < data.length; i++) {
                        var id = data[i].ArabaId;
                        var markaAd = data[i].Ad;
                        $("#markamodelduzenle").append("<option value='" + id + "'>" + markaAd + "</option>");
                    }
                    $("#markamodelduzenle").val(select);
                }, error: function () {
                    console.log("basarisiz");
                }
            });
        }

        function modelDuzenle() {
            var hatayok = true;
            if ($("#modelDuzenleAd").val().trim() == "") {
                $("#lblModelDuzenleBos").show();
                $("#lblModelDuzenleSeriBos").hide();
                hatayok = false;
            } else if ($("#serimodelduzenle").val() == null) {
                $("#lblModelDuzenleSeriBos").show();
                $("#lblModelDuzenleBos").hide();
                hatayok = false;
            } else {
                $.ajax(
                    {
                        url: "/Admin/MSM/SeriGuncelle",
                        method: "Post",
                        data: {
                            ArabaId: modelId,
                            Ad: $("#modelDuzenleAd").val(),
                            UstKategori: $("#serimodelduzenle").val()
                        }, success: function (data) {
                            if (data == "True") {
                                modelDuzenle();
                                $("#lblModelDuzenleBos").hide();
                                $("#lblModelDuzenleSeriBos").hide();
                                alert("Model Güncellendi !!!");
                            } else {
                                alert("Model Güncellemede Hata !!!");
                            }
                        }, error: function (data) {
                            alert(data);
                        }
                    });
            }
            return hatayok;
        }
      
    </script>
}

